// ==UserScript==
// @name        tryrating-userscript
// @version     1.2.9
// @author      crashmax <userscript@crashmax.ru>
// @license     MIT
// @homepage    https://crashmax-dev.github.io/tryrating-userscript/
// @match       https://www.tryrating.com/app/survey/*
// @grant       GM_setValue
// @grant       GM_getValue
// @grant       GM_addStyle
// @grant       GM_notification
// @updateURL   https://crashmax-dev.github.io/tryrating-userscript/tryrating-userscript.meta.js
// @downloadURL https://crashmax-dev.github.io/tryrating-userscript/tryrating-userscript.user.js
// ==/UserScript==

(function(){"use strict";const ut={equals:(t,n)=>t===n};let pe=Bt;const G=1,ct=2,Nt={owned:null,cleanups:null,context:null,owner:null};var B=null;let bt=null,A=null,N=null,P=null,lt=0;function ge(t,n){const e=A,s=B,r=t.length===0,i=r?Nt:{owned:null,cleanups:null,context:null,owner:n===void 0?s:n},a=r?t:()=>t(()=>dt(()=>pt(i)));B=i,A=null;try{return st(a,!0)}finally{A=e,B=s}}function nt(t,n){n=n?Object.assign({},ut,n):ut;const e={value:t,observers:null,observerSlots:null,comparator:n.equals||void 0},s=r=>(typeof r=="function"&&(r=r(e.value)),Ut(e,r));return[Rt.bind(e),s]}function ft(t,n,e){const s=Ft(t,n,!1,G);ht(s)}function St(t,n,e){e=e?Object.assign({},ut,e):ut;const s=Ft(t,n,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=e.equals||void 0,ht(s),Rt.bind(s)}function dt(t){if(A===null)return t();const n=A;A=null;try{return t()}finally{A=n}}function Rt(){if(this.sources&&this.state)if(this.state===G)ht(this);else{const t=N;N=null,st(()=>mt(this),!1),N=t}if(A){const t=this.observers?this.observers.length:0;A.sources?(A.sources.push(this),A.sourceSlots.push(t)):(A.sources=[this],A.sourceSlots=[t]),this.observers?(this.observers.push(A),this.observerSlots.push(A.sources.length-1)):(this.observers=[A],this.observerSlots=[A.sources.length-1])}return this.value}function Ut(t,n,e){let s=t.value;return(!t.comparator||!t.comparator(s,n))&&(t.value=n,t.observers&&t.observers.length&&st(()=>{for(let r=0;r<t.observers.length;r+=1){const i=t.observers[r],a=bt&&bt.running;a&&bt.disposed.has(i),(a?!i.tState:!i.state)&&(i.pure?N.push(i):P.push(i),i.observers&&zt(i)),a||(i.state=G)}if(N.length>1e6)throw N=[],new Error},!1)),n}function ht(t){if(!t.fn)return;pt(t);const n=B,e=A,s=lt;A=B=t,ye(t,t.value,s),A=e,B=n}function ye(t,n,e){let s;try{s=t.fn(n)}catch(r){return t.pure&&(t.state=G,t.owned&&t.owned.forEach(pt),t.owned=null),t.updatedAt=e+1,Ht(r)}(!t.updatedAt||t.updatedAt<=e)&&(t.updatedAt!=null&&"observers"in t?Ut(t,s):t.value=s,t.updatedAt=e)}function Ft(t,n,e,s=G,r){const i={fn:t,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:n,owner:B,context:null,pure:e};return B===null||B!==Nt&&(B.owned?B.owned.push(i):B.owned=[i]),i}function Yt(t){if(t.state===0)return;if(t.state===ct)return mt(t);if(t.suspense&&dt(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<lt);)t.state&&n.push(t);for(let e=n.length-1;e>=0;e--)if(t=n[e],t.state===G)ht(t);else if(t.state===ct){const s=N;N=null,st(()=>mt(t,n[0]),!1),N=s}}function st(t,n){if(N)return t();let e=!1;n||(N=[]),P?e=!0:P=[],lt++;try{const s=t();return $e(e),s}catch(s){e||(P=null),N=null,Ht(s)}}function $e(t){if(N&&(Bt(N),N=null),t)return;const n=P;P=null,n.length&&st(()=>pe(n),!1)}function Bt(t){for(let n=0;n<t.length;n++)Yt(t[n])}function mt(t,n){t.state=0;for(let e=0;e<t.sources.length;e+=1){const s=t.sources[e];if(s.sources){const r=s.state;r===G?s!==n&&(!s.updatedAt||s.updatedAt<lt)&&Yt(s):r===ct&&mt(s,n)}}}function zt(t){for(let n=0;n<t.observers.length;n+=1){const e=t.observers[n];e.state||(e.state=ct,e.pure?N.push(e):P.push(e),e.observers&&zt(e))}}function pt(t){let n;if(t.sources)for(;t.sources.length;){const e=t.sources.pop(),s=t.sourceSlots.pop(),r=e.observers;if(r&&r.length){const i=r.pop(),a=e.observerSlots.pop();s<r.length&&(i.sourceSlots[a]=s,r[s]=i,e.observerSlots[s]=a)}}if(t.owned){for(n=t.owned.length-1;n>=0;n--)pt(t.owned[n]);t.owned=null}if(t.cleanups){for(n=t.cleanups.length-1;n>=0;n--)t.cleanups[n]();t.cleanups=null}t.state=0,t.context=null}function we(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Ht(t,n=B){throw we(t)}function jt(t,n){return dt(()=>t(n||{}))}function Te(t,n,e){let s=e.length,r=n.length,i=s,a=0,o=0,m=n[r-1].nextSibling,p=null;for(;a<r||o<i;){if(n[a]===e[o]){a++,o++;continue}for(;n[r-1]===e[i-1];)r--,i--;if(r===a){const h=i<s?o?e[o-1].nextSibling:e[i-o]:m;for(;o<i;)t.insertBefore(e[o++],h)}else if(i===o)for(;a<r;)(!p||!p.has(n[a]))&&n[a].remove(),a++;else if(n[a]===e[i-1]&&e[o]===n[r-1]){const h=n[--r].nextSibling;t.insertBefore(e[o++],n[a++].nextSibling),t.insertBefore(e[--i],h),n[r]=e[i]}else{if(!p){p=new Map;let g=o;for(;g<i;)p.set(e[g],g++)}const h=p.get(n[a]);if(h!=null)if(o<h&&h<i){let g=a,y=1,v;for(;++g<r&&g<i&&!((v=p.get(n[g]))==null||v!==h+y);)y++;if(y>h-o){const S=n[a];for(;o<h;)t.insertBefore(e[o++],S)}else t.replaceChild(e[o++],n[a++])}else a++;else n[a++].remove()}}}const qt="_$DX_DELEGATE";function ve(t,n,e,s={}){let r;return ge(i=>{r=i,n===document?t():rt(n,t(),n.firstChild?null:void 0,e)},s.owner),()=>{r(),n.textContent=""}}function Wt(t,n,e){let s;const r=()=>{const a=document.createElement("template");return a.innerHTML=t,e?a.content.firstChild.firstChild:a.content.firstChild},i=n?()=>dt(()=>document.importNode(s||(s=r()),!0)):()=>(s||(s=r())).cloneNode(!0);return i.cloneNode=i,i}function be(t,n=window.document){const e=n[qt]||(n[qt]=new Set);for(let s=0,r=t.length;s<r;s++){const i=t[s];e.has(i)||(e.add(i),n.addEventListener(i,Se))}}function rt(t,n,e,s){if(e!==void 0&&!s&&(s=[]),typeof n!="function")return gt(t,n,s,e);ft(r=>gt(t,n(),r,e),s)}function Se(t){const n=`$$${t.type}`;let e=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==e&&Object.defineProperty(t,"target",{configurable:!0,value:e}),Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}});e;){const s=e[n];if(s&&!e.disabled){const r=e[`${n}Data`];if(r!==void 0?s.call(e,r,t):s.call(e,t),t.cancelBubble)return}e=e._$host||e.parentNode||e.host}}function gt(t,n,e,s,r){for(;typeof e=="function";)e=e();if(n===e)return e;const i=typeof n,a=s!==void 0;if(t=a&&e[0]&&e[0].parentNode||t,i==="string"||i==="number")if(i==="number"&&(n=n.toString()),a){let o=e[0];o&&o.nodeType===3?o.data=n:o=document.createTextNode(n),e=X(t,e,s,o)}else e!==""&&typeof e=="string"?e=t.firstChild.data=n:e=t.textContent=n;else if(n==null||i==="boolean")e=X(t,e,s);else{if(i==="function")return ft(()=>{let o=n();for(;typeof o=="function";)o=o();e=gt(t,o,e,s)}),()=>e;if(Array.isArray(n)){const o=[],m=e&&Array.isArray(e);if(Mt(o,n,e,r))return ft(()=>e=gt(t,o,e,s,!0)),()=>e;if(o.length===0){if(e=X(t,e,s),a)return e}else m?e.length===0?Gt(t,o,s):Te(t,e,o):(e&&X(t),Gt(t,o));e=o}else if(n.nodeType){if(Array.isArray(e)){if(a)return e=X(t,e,s,n);X(t,e,null,n)}else e==null||e===""||!t.firstChild?t.appendChild(n):t.replaceChild(n,t.firstChild);e=n}else console.warn("Unrecognized value. Skipped inserting",n)}return e}function Mt(t,n,e,s){let r=!1;for(let i=0,a=n.length;i<a;i++){let o=n[i],m=e&&e[i],p;if(!(o==null||o===!0||o===!1))if((p=typeof o)=="object"&&o.nodeType)t.push(o);else if(Array.isArray(o))r=Mt(t,o,m)||r;else if(p==="function")if(s){for(;typeof o=="function";)o=o();r=Mt(t,Array.isArray(o)?o:[o],Array.isArray(m)?m:[m])||r}else t.push(o),r=!0;else{const h=String(o);m&&m.nodeType===3&&m.data===h?t.push(m):t.push(document.createTextNode(h))}}return r}function Gt(t,n,e=null){for(let s=0,r=n.length;s<r;s++)t.insertBefore(n[s],e)}function X(t,n,e,s){if(e===void 0)return t.textContent="";const r=s||document.createTextNode("");if(n.length){let i=!1;for(let a=n.length-1;a>=0;a--){const o=n[a];if(r!==o){const m=o.parentNode===t;!i&&!a?m?t.replaceChild(r,o):t.insertBefore(r,e):m&&o.remove()}else i=!0}}else t.insertBefore(r,e);return[r]}const Me=t=>(n,e)=>(t.set(n,e),e),Pt=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,Vt=536870912,Kt=Vt*2,Ee=(t,n)=>e=>{const s=n.get(e);let r=s===void 0?e.size:s<Kt?s+1:0;if(!e.has(r))return t(e,r);if(e.size<Vt){for(;e.has(r);)r=Math.floor(Math.random()*Kt);return t(e,r)}if(e.size>Pt)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;e.has(r);)r=Math.floor(Math.random()*Pt);return t(e,r)},Zt=new WeakMap,Oe=Me(Zt),yt=Ee(Oe,Zt),ke=t=>t.method!==void 0&&t.method==="call",De=t=>t.error===null&&typeof t.id=="number",Xt=((t,n)=>{let e=null;return()=>{if(e!==null)return e;const s=new Blob([n],{type:"application/javascript; charset=utf-8"}),r=URL.createObjectURL(s);return e=t(r),setTimeout(()=>URL.revokeObjectURL(r)),e}})(t=>{const n=new Map([[0,()=>{}]]),e=new Map([[0,()=>{}]]),s=new Map,r=new Worker(t);return r.addEventListener("message",({data:p})=>{if(ke(p)){const{params:{timerId:h,timerType:g}}=p;if(g==="interval"){const y=n.get(h);if(typeof y=="number"){const v=s.get(y);if(v===void 0||v.timerId!==h||v.timerType!==g)throw new Error("The timer is in an undefined state.")}else if(typeof y<"u")y();else throw new Error("The timer is in an undefined state.")}else if(g==="timeout"){const y=e.get(h);if(typeof y=="number"){const v=s.get(y);if(v===void 0||v.timerId!==h||v.timerType!==g)throw new Error("The timer is in an undefined state.")}else if(typeof y<"u")y(),e.delete(h);else throw new Error("The timer is in an undefined state.")}}else if(De(p)){const{id:h}=p,g=s.get(h);if(g===void 0)throw new Error("The timer is in an undefined state.");const{timerId:y,timerType:v}=g;s.delete(h),v==="interval"?n.delete(y):e.delete(y)}else{const{error:{message:h}}=p;throw new Error(h)}}),{clearInterval:p=>{const h=yt(s);s.set(h,{timerId:p,timerType:"interval"}),n.set(p,h),r.postMessage({id:h,method:"clear",params:{timerId:p,timerType:"interval"}})},clearTimeout:p=>{const h=yt(s);s.set(h,{timerId:p,timerType:"timeout"}),e.set(p,h),r.postMessage({id:h,method:"clear",params:{timerId:p,timerType:"timeout"}})},setInterval:(p,h)=>{const g=yt(n);return n.set(g,()=>{p(),typeof n.get(g)=="function"&&r.postMessage({id:null,method:"set",params:{delay:h,now:performance.now(),timerId:g,timerType:"interval"}})}),r.postMessage({id:null,method:"set",params:{delay:h,now:performance.now(),timerId:g,timerType:"interval"}}),g},setTimeout:(p,h)=>{const g=yt(e);return e.set(g,p),r.postMessage({id:null,method:"set",params:{delay:h,now:performance.now(),timerId:g,timerType:"timeout"}}),g}}},`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`),Jt=t=>Xt().clearInterval(t),Et=(t,n)=>Xt().setInterval(t,n);function L(t,n,...e){const s=document.createElement(t);return n instanceof Node?s.append(n):typeof n=="string"?s.append(Ce(n)):Array.isArray(n)?s.append(...n):(Object.assign(s,n),Object.assign(s.style,n?.style)),s.append(...e),s}function Ce(t){return document.createTextNode(t)}function Ae(t,n,e){const s=new MutationObserver((r,i)=>{for(const a of r)n(a,i)});return s.observe(t,{childList:!0,subtree:!0,...e}),()=>s.disconnect()}const J=1e3,Q=J*60,tt=Q*60,V=tt*24,_e=V*7,xe=V*365.25;function Ot(t,n){try{if(typeof t=="string"&&t.length>0)return Le(t);if(typeof t=="number"&&isFinite(t))return n?.long?Ne(t):Ie(t);throw new Error("Value is not a string or number.")}catch(e){const s=Re(e)?`${e.message}. value=${JSON.stringify(t)}`:"An unknown error has occured.";throw new Error(s)}}function Le(t){if(t=String(t),t.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const n=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!n)return NaN;const e=parseFloat(n[1]),s=(n[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return e*xe;case"weeks":case"week":case"w":return e*_e;case"days":case"day":case"d":return e*V;case"hours":case"hour":case"hrs":case"hr":case"h":return e*tt;case"minutes":case"minute":case"mins":case"min":case"m":return e*Q;case"seconds":case"second":case"secs":case"sec":case"s":return e*J;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:throw new Error(`The unit ${s} was matched, but no matching case exists.`)}}function Ie(t){const n=Math.abs(t);return n>=V?`${Math.round(t/V)}d`:n>=tt?`${Math.round(t/tt)}h`:n>=Q?`${Math.round(t/Q)}m`:n>=J?`${Math.round(t/J)}s`:`${t}ms`}function Ne(t){const n=Math.abs(t);return n>=V?$t(t,n,V,"day"):n>=tt?$t(t,n,tt,"hour"):n>=Q?$t(t,n,Q,"minute"):n>=J?$t(t,n,J,"second"):`${t} ms`}function $t(t,n,e,s){const r=n>=e*1.5;return`${Math.round(t/e)} ${s}${r?"s":""}`}function Re(t){return typeof t=="object"&&t!==null&&"message"in t}class Ue{constructor(n){this.storage=n}download(){const n=this.storage.taskList;if(!n.length){alert("\u041D\u0435\u0442\u0443 \u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u044D\u043A\u0441\u043F\u043E\u0440\u0442\u0430.");return}const e=L("div");for(const{date:i,list:a,total:o}of n){let m=0;const p=L("table",{border:"1"}),h=L("div",{style:{display:"flex",gap:"4px",flexDirection:"column"}}),g=L("tr",L("th","Task Type"),L("th","Count"),L("th","Estimated Rating Time"));p.append(h,g);for(const{count:y,estimated:v,type:S}of a){m+=v;const f=L("tr",L("td",S),L("td",`${y}`),L("td",Ot(v,{long:!0})));p.append(f)}h.append(L("span",`Date: ${i}`),L("span",`Tasks ${o}`),L("span",`Estimated time: ${Ot(m,{long:!0})}`)),e.append(L("div",p,L("hr")))}const s=new Blob([e.outerHTML],{type:"text/html"});L("a",{href:URL.createObjectURL(s),download:`tryrating-com-${new Date().toISOString()}.html`}).click()}}const Fe=Wt("<button>Autosubmit"),[wt,Ye]=nt(!0);function Qt(){Ye(!wt())}function kt(){return{get autosubmit(){return wt()},toggleAutosubmit:Qt}}const Be=()=>(()=>{const t=Fe();return t.$$click=()=>Qt(),ft(()=>(wt()?"#4CAF50":"#f44336")!=null?t.style.setProperty("background",wt()?"#4CAF50":"#f44336"):t.style.removeProperty("background")),t})();be(["click"]);const{toggleAutosubmit:ze}=kt();function He(t,n){window.addEventListener("keydown",e=>{e.altKey&&e.key==="1"&&(e.preventDefault(),t.download()),e.altKey&&e.key==="2"&&(e.preventDefault(),confirm(`Reset data.
Are you sure?`)&&n.reset()),e.ctrlKey&&e.code==="KeyO"&&(e.preventDefault(),ze())})}const je=".modal-container.visible",qe="div[modalwrapref] > div",te="Validation failed!";function We(){const t=document.querySelector(je);if(!t)return;const n=t.querySelector(qe);n&&n.textContent===te&&(GM_notification({title:document.title,text:te,highlight:!0,silent:!1,timeout:1e3}),t.querySelector("button")?.click())}function Ge(){const t=document.querySelector("#app-root");if(!t)throw new Error("App root not found");Ae(t,n=>{We()})}const[Pe,ee]=nt(0);class Ve{intervalId;get time(){return Pe()}tick(){ee(n=>n+1e3)}start(){this.intervalId&&(Jt(this.intervalId),ee(0)),this.intervalId=Et(()=>this.tick(),1e3)}}var Dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ct(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ne={exports:{}};(function(t,n){(function(e,s){t.exports=s()})(Dt,function(){var e=1e3,s=6e4,r=36e5,i="millisecond",a="second",o="minute",m="hour",p="day",h="week",g="month",y="quarter",v="year",S="date",f="Invalid Date",M=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,I=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,k={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function($){var l=["th","st","nd","rd"],u=$%100;return"["+$+(l[(u-20)%10]||l[u]||l[0])+"]"}},D=function($,l,u){var d=String($);return!d||d.length>=l?$:""+Array(l+1-d.length).join(u)+$},z={s:D,z:function($){var l=-$.utcOffset(),u=Math.abs(l),d=Math.floor(u/60),c=u%60;return(l<=0?"+":"-")+D(d,2,"0")+":"+D(c,2,"0")},m:function $(l,u){if(l.date()<u.date())return-$(u,l);var d=12*(u.year()-l.year())+(u.month()-l.month()),c=l.clone().add(d,g),w=u-c<0,T=l.clone().add(d+(w?-1:1),g);return+(-(d+(u-c)/(w?c-T:T-c))||0)},a:function($){return $<0?Math.ceil($)||0:Math.floor($)},p:function($){return{M:g,y:v,w:h,d:p,D:S,h:m,m:o,s:a,ms:i,Q:y}[$]||String($||"").toLowerCase().replace(/s$/,"")},u:function($){return $===void 0}},_="en",U={};U[_]=k;var F=function($){return $ instanceof q},H=function $(l,u,d){var c;if(!l)return _;if(typeof l=="string"){var w=l.toLowerCase();U[w]&&(c=w),u&&(U[w]=u,c=w);var T=l.split("-");if(!c&&T.length>1)return $(T[0])}else{var O=l.name;U[O]=l,c=O}return!d&&c&&(_=c),c||!d&&_},E=function($,l){if(F($))return $.clone();var u=typeof l=="object"?l:{};return u.date=$,u.args=arguments,new q(u)},b=z;b.l=H,b.i=F,b.w=function($,l){return E($,{locale:l.$L,utc:l.$u,x:l.$x,$offset:l.$offset})};var q=function(){function $(u){this.$L=H(u.locale,null,!0),this.parse(u)}var l=$.prototype;return l.parse=function(u){this.$d=function(d){var c=d.date,w=d.utc;if(c===null)return new Date(NaN);if(b.u(c))return new Date;if(c instanceof Date)return new Date(c);if(typeof c=="string"&&!/Z$/i.test(c)){var T=c.match(M);if(T){var O=T[2]-1||0,C=(T[7]||"0").substring(0,3);return w?new Date(Date.UTC(T[1],O,T[3]||1,T[4]||0,T[5]||0,T[6]||0,C)):new Date(T[1],O,T[3]||1,T[4]||0,T[5]||0,T[6]||0,C)}}return new Date(c)}(u),this.$x=u.x||{},this.init()},l.init=function(){var u=this.$d;this.$y=u.getFullYear(),this.$M=u.getMonth(),this.$D=u.getDate(),this.$W=u.getDay(),this.$H=u.getHours(),this.$m=u.getMinutes(),this.$s=u.getSeconds(),this.$ms=u.getMilliseconds()},l.$utils=function(){return b},l.isValid=function(){return this.$d.toString()!==f},l.isSame=function(u,d){var c=E(u);return this.startOf(d)<=c&&c<=this.endOf(d)},l.isAfter=function(u,d){return E(u)<this.startOf(d)},l.isBefore=function(u,d){return this.endOf(d)<E(u)},l.$g=function(u,d,c){return b.u(u)?this[d]:this.set(c,u)},l.unix=function(){return Math.floor(this.valueOf()/1e3)},l.valueOf=function(){return this.$d.getTime()},l.startOf=function(u,d){var c=this,w=!!b.u(d)||d,T=b.p(u),O=function(Z,Y){var W=b.w(c.$u?Date.UTC(c.$y,Y,Z):new Date(c.$y,Y,Z),c);return w?W:W.endOf(p)},C=function(Z,Y){return b.w(c.toDate()[Z].apply(c.toDate("s"),(w?[0,0,0,0]:[23,59,59,999]).slice(Y)),c)},x=this.$W,R=this.$M,j=this.$D,et="set"+(this.$u?"UTC":"");switch(T){case v:return w?O(1,0):O(31,11);case g:return w?O(1,R):O(0,R+1);case h:var K=this.$locale().weekStart||0,ot=(x<K?x+7:x)-K;return O(w?j-ot:j+(6-ot),R);case p:case S:return C(et+"Hours",0);case m:return C(et+"Minutes",1);case o:return C(et+"Seconds",2);case a:return C(et+"Milliseconds",3);default:return this.clone()}},l.endOf=function(u){return this.startOf(u,!1)},l.$set=function(u,d){var c,w=b.p(u),T="set"+(this.$u?"UTC":""),O=(c={},c[p]=T+"Date",c[S]=T+"Date",c[g]=T+"Month",c[v]=T+"FullYear",c[m]=T+"Hours",c[o]=T+"Minutes",c[a]=T+"Seconds",c[i]=T+"Milliseconds",c)[w],C=w===p?this.$D+(d-this.$W):d;if(w===g||w===v){var x=this.clone().set(S,1);x.$d[O](C),x.init(),this.$d=x.set(S,Math.min(this.$D,x.daysInMonth())).$d}else O&&this.$d[O](C);return this.init(),this},l.set=function(u,d){return this.clone().$set(u,d)},l.get=function(u){return this[b.p(u)]()},l.add=function(u,d){var c,w=this;u=Number(u);var T=b.p(d),O=function(R){var j=E(w);return b.w(j.date(j.date()+Math.round(R*u)),w)};if(T===g)return this.set(g,this.$M+u);if(T===v)return this.set(v,this.$y+u);if(T===p)return O(1);if(T===h)return O(7);var C=(c={},c[o]=s,c[m]=r,c[a]=e,c)[T]||1,x=this.$d.getTime()+u*C;return b.w(x,this)},l.subtract=function(u,d){return this.add(-1*u,d)},l.format=function(u){var d=this,c=this.$locale();if(!this.isValid())return c.invalidDate||f;var w=u||"YYYY-MM-DDTHH:mm:ssZ",T=b.z(this),O=this.$H,C=this.$m,x=this.$M,R=c.weekdays,j=c.months,et=c.meridiem,K=function(Y,W,at,vt){return Y&&(Y[W]||Y(d,w))||at[W].slice(0,vt)},ot=function(Y){return b.s(O%12||12,Y,"0")},Z=et||function(Y,W,at){var vt=Y<12?"AM":"PM";return at?vt.toLowerCase():vt};return w.replace(I,function(Y,W){return W||function(at){switch(at){case"YY":return String(d.$y).slice(-2);case"YYYY":return b.s(d.$y,4,"0");case"M":return x+1;case"MM":return b.s(x+1,2,"0");case"MMM":return K(c.monthsShort,x,j,3);case"MMMM":return K(j,x);case"D":return d.$D;case"DD":return b.s(d.$D,2,"0");case"d":return String(d.$W);case"dd":return K(c.weekdaysMin,d.$W,R,2);case"ddd":return K(c.weekdaysShort,d.$W,R,3);case"dddd":return R[d.$W];case"H":return String(O);case"HH":return b.s(O,2,"0");case"h":return ot(1);case"hh":return ot(2);case"a":return Z(O,C,!0);case"A":return Z(O,C,!1);case"m":return String(C);case"mm":return b.s(C,2,"0");case"s":return String(d.$s);case"ss":return b.s(d.$s,2,"0");case"SSS":return b.s(d.$ms,3,"0");case"Z":return T}return null}(Y)||T.replace(":","")})},l.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},l.diff=function(u,d,c){var w,T=this,O=b.p(d),C=E(u),x=(C.utcOffset()-this.utcOffset())*s,R=this-C,j=function(){return b.m(T,C)};switch(O){case v:w=j()/12;break;case g:w=j();break;case y:w=j()/3;break;case h:w=(R-x)/6048e5;break;case p:w=(R-x)/864e5;break;case m:w=R/r;break;case o:w=R/s;break;case a:w=R/e;break;default:w=R}return c?w:b.a(w)},l.daysInMonth=function(){return this.endOf(g).$D},l.$locale=function(){return U[this.$L]},l.locale=function(u,d){if(!u)return this.$L;var c=this.clone(),w=H(u,d,!0);return w&&(c.$L=w),c},l.clone=function(){return b.w(this.$d,this)},l.toDate=function(){return new Date(this.valueOf())},l.toJSON=function(){return this.isValid()?this.toISOString():null},l.toISOString=function(){return this.$d.toISOString()},l.toString=function(){return this.$d.toUTCString()},$}(),me=q.prototype;return E.prototype=me,[["$ms",i],["$s",a],["$m",o],["$H",m],["$W",p],["$M",g],["$y",v],["$D",S]].forEach(function($){me[$[1]]=function(l){return this.$g(l,$[0],$[1])}}),E.extend=function($,l){return $.$i||($(l,q,E),$.$i=!0),E},E.locale=H,E.isDayjs=F,E.unix=function($){return E(1e3*$)},E.en=U[_],E.Ls=U,E.p={},E})})(ne);var Ke=ne.exports;const At=Ct(Ke);var se={exports:{}};(function(t,n){(function(e,s){t.exports=s()})(Dt,function(){var e={year:0,month:1,day:2,hour:3,minute:4,second:5},s={};return function(r,i,a){var o,m=function(y,v,S){S===void 0&&(S={});var f=new Date(y),M=function(I,k){k===void 0&&(k={});var D=k.timeZoneName||"short",z=I+"|"+D,_=s[z];return _||(_=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:I,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:D}),s[z]=_),_}(v,S);return M.formatToParts(f)},p=function(y,v){for(var S=m(y,v),f=[],M=0;M<S.length;M+=1){var I=S[M],k=I.type,D=I.value,z=e[k];z>=0&&(f[z]=parseInt(D,10))}var _=f[3],U=_===24?0:_,F=f[0]+"-"+f[1]+"-"+f[2]+" "+U+":"+f[4]+":"+f[5]+":000",H=+y;return(a.utc(F).valueOf()-(H-=H%1e3))/6e4},h=i.prototype;h.tz=function(y,v){y===void 0&&(y=o);var S=this.utcOffset(),f=this.toDate(),M=f.toLocaleString("en-US",{timeZone:y}),I=Math.round((f-new Date(M))/1e3/60),k=a(M).$set("millisecond",this.$ms).utcOffset(15*-Math.round(f.getTimezoneOffset()/15)-I,!0);if(v){var D=k.utcOffset();k=k.add(S-D,"minute")}return k.$x.$timezone=y,k},h.offsetName=function(y){var v=this.$x.$timezone||a.tz.guess(),S=m(this.valueOf(),v,{timeZoneName:y}).find(function(f){return f.type.toLowerCase()==="timezonename"});return S&&S.value};var g=h.startOf;h.startOf=function(y,v){if(!this.$x||!this.$x.$timezone)return g.call(this,y,v);var S=a(this.format("YYYY-MM-DD HH:mm:ss:SSS"));return g.call(S,y,v).tz(this.$x.$timezone,!0)},a.tz=function(y,v,S){var f=S&&v,M=S||v||o,I=p(+a(),M);if(typeof y!="string")return a(y).tz(M);var k=function(U,F,H){var E=U-60*F*1e3,b=p(E,H);if(F===b)return[E,F];var q=p(E-=60*(b-F)*1e3,H);return b===q?[E,b]:[U-60*Math.min(b,q)*1e3,Math.max(b,q)]}(a.utc(y,f).valueOf(),I,M),D=k[0],z=k[1],_=a(D).utcOffset(z);return _.$x.$timezone=M,_},a.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},a.tz.setDefault=function(y){o=y}}})})(se);var Ze=se.exports;const Xe=Ct(Ze);var re={exports:{}};(function(t,n){(function(e,s){t.exports=s()})(Dt,function(){var e="minute",s=/[+-]\d\d(?::?\d\d)?/g,r=/([+-]|\d\d)/g;return function(i,a,o){var m=a.prototype;o.utc=function(f){var M={date:f,utc:!0,args:arguments};return new a(M)},m.utc=function(f){var M=o(this.toDate(),{locale:this.$L,utc:!0});return f?M.add(this.utcOffset(),e):M},m.local=function(){return o(this.toDate(),{locale:this.$L,utc:!1})};var p=m.parse;m.parse=function(f){f.utc&&(this.$u=!0),this.$utils().u(f.$offset)||(this.$offset=f.$offset),p.call(this,f)};var h=m.init;m.init=function(){if(this.$u){var f=this.$d;this.$y=f.getUTCFullYear(),this.$M=f.getUTCMonth(),this.$D=f.getUTCDate(),this.$W=f.getUTCDay(),this.$H=f.getUTCHours(),this.$m=f.getUTCMinutes(),this.$s=f.getUTCSeconds(),this.$ms=f.getUTCMilliseconds()}else h.call(this)};var g=m.utcOffset;m.utcOffset=function(f,M){var I=this.$utils().u;if(I(f))return this.$u?0:I(this.$offset)?g.call(this):this.$offset;if(typeof f=="string"&&(f=function(_){_===void 0&&(_="");var U=_.match(s);if(!U)return null;var F=(""+U[0]).match(r)||["-",0,0],H=F[0],E=60*+F[1]+ +F[2];return E===0?0:H==="+"?E:-E}(f),f===null))return this;var k=Math.abs(f)<=16?60*f:f,D=this;if(M)return D.$offset=k,D.$u=f===0,D;if(f!==0){var z=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(D=this.local().add(k+z,e)).$offset=k,D.$x.$localOffset=z}else D=this.utc();return D};var y=m.format;m.format=function(f){var M=f||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return y.call(this,M)},m.valueOf=function(){var f=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*f},m.isUTC=function(){return!!this.$u},m.toISOString=function(){return this.toDate().toISOString()},m.toString=function(){return this.toDate().toUTCString()};var v=m.toDate;m.toDate=function(f){return f==="s"&&this.$offset?o(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():v.call(this)};var S=m.diff;m.diff=function(f,M,I){if(f&&this.$u===f.$u)return S.call(this,f,M,I);var k=this.local(),D=o(f).local();return S.call(k,D,M,I)}}})})(re);var Je=re.exports;const Qe=Ct(Je);At.extend(Qe),At.extend(Xe);const ie={offset:180,region:"Asia",location:"Kuwait"};function _t(){return At.tz(new Date,`${ie.region}/${ie.location}`).format("DD.MM.YYYY")}const xt=()=>[{date:_t(),total:0,list:[]}],[it,Lt]=nt([]);class tn{STORAGE_KEY="tryrating-storage-v2";constructor(){this.read()}get taskList(){return it()}read(){const n=GM_getValue(this.STORAGE_KEY,xt());Lt(n)}reset(){Lt(xt()),GM_setValue(this.STORAGE_KEY,it())}write(n){const e=this.getTaskList();e.total+=1;const s=e.list.find(i=>i.type===n.type);s?(s.count+=1,s.estimated+=n.estimated):e.list.push({count:1,type:n.type,estimated:n.estimated});const r=[e,...it().filter(i=>i.date!==e.date)];Lt(r),GM_setValue(this.STORAGE_KEY,it())}getTaskList(){const n=_t(),e=it().find(s=>s.date===n);return e||xt()[0]}}const en=".btn-success",nn="Submit Rating",[sn,rn]=nt([]);function on(){const t=[],n=Array.from(document.querySelectorAll(en));for(const e of n)e instanceof HTMLButtonElement&&e.textContent===nn&&t.push(e);return rn(t),t}function an(){return{findSubmitButtons:on,get submitButtons(){return sn()}}}function oe(t){return t.split(/\s(?=\d)/).reduce((e,s)=>(e+=Ot(s),e),0)}const un=".survey-meta-fields",cn=".labeled-attribute__attribute",{autosubmit:ln,toggleAutosubmit:fn}=kt();class dn{constructor(n){this.storage=n}taskFields=null;onChangeTaskCallback=null;onChangeTask(n){this.onChangeTaskCallback=n}observe(){const n=document.querySelector(un);if(!n){console.error("Task fields not found");return}const e=Array.from(n.querySelectorAll(cn));if(!e.length){console.error("Task fields attributes not found");return}const[s,r,i]=e,a={taskType:s.textContent,requestId:r.textContent,estimatedRatingTime:i.textContent.trim()};a.requestId!==this.taskFields?.requestId&&(this.onChangeTaskCallback(a),ln||fn(),this.taskFields&&(console.info("Current task is submitted:",this.taskFields),this.storage.write({type:this.taskFields.taskType,estimated:oe(this.taskFields.estimatedRatingTime)})),this.taskFields=a)}}const[ae,ue]=nt(0);class hn{intervalId;onEndCallback;onTickTimer(){const n=ae()-1e3;ue(n),n===0&&(this.onEndCallback(),this.stop())}get time(){return ae()}onTimerEnd(n){this.onEndCallback=n}start(n){this.stop(),ue(n),this.intervalId=Et(()=>this.onTickTimer(),1e3)}stop(){this.intervalId&&(Jt(this.intervalId),this.intervalId=null)}}function ce(t){return t=Math.abs(t),t>9?`${t}`:`0${t}`}function le(t){const n=ce(Math.floor(t/6e4)),e=ce(Number((t%6e4/1e3).toFixed(0)));return`${n}:${e}`}const bn="",mn=Wt('<div class="tryrating-widget"><div>Timer: </div><div>Stopwatch: </div><div>Tasks: '),{autosubmit:pn}=kt(),{findSubmitButtons:fe}=an(),Tt=new tn,de=new Ve,gn=new Ue(Tt),It=new hn;It.onTimerEnd(()=>{if(!pn)return;const t=fe();if(!t.length){console.error("submitButtons is not defined");return}t[0].click()});const he=new dn(Tt);he.onChangeTask(t=>{fe();const n=oe(t.estimatedRatingTime);It.start(n),de.start()});const yn=()=>{const t=St(()=>le(It.time)),n=St(()=>le(de.time)),e=St(()=>{const s=_t();return Tt.taskList.find(i=>i.date===s)?.total??"0"});return(()=>{const s=mn(),r=s.firstChild;r.firstChild;const i=r.nextSibling;i.firstChild;const a=i.nextSibling;return a.firstChild,rt(r,t,null),rt(i,n,null),rt(a,e,null),rt(s,jt(Be,{}),null),s})()};He(gn,Tt),Ge(),Et(()=>he.observe(),5e3),ve(()=>jt(yn,{}),document.body),GM_addStyle(".tryrating-widget{display:flex;color:#fff;padding-left:4px;gap:6px;position:absolute;z-index:9999999;background:#2e2c2f;font-size:1rem;font-weight:600;align-items:center;left:0;bottom:0;height:40px;justify-content:center}.tryrating-widget>button{height:inherit;border:none;font-size:inherit;font-weight:inherit;background:#2e2c2f;color:#fff}")})();
