var __defProp=Object.defineProperty,__defNormalProp=(a,l,h)=>l in a?__defProp(a,l,{enumerable:!0,configurable:!0,writable:!0,value:h}):a[l]=h,__publicField=(a,l,h)=>(__defNormalProp(a,typeof l!="symbol"?l+"":l,h),h);(function(){"use strict";function a(e,t,...r){const n=document.createElement(e);return typeof t=="string"?n.append(l(t)):Array.isArray(t)?r.unshift(...t):(Object.assign(n,t),Object.assign(n.style,t?.style)),r.length&&n.append(...r),n}function l(e){return document.createTextNode(e)}function h(e,t,r){const n=new MutationObserver((s,d)=>{for(const E of s)t(E,d)});return n.observe(e,{childList:!0,subtree:!0,...r}),()=>n.disconnect()}function k(e,t=document.body){return new Promise(r=>{h(t,(n,s)=>{const d=t.querySelector(e);d&&(s.disconnect(),r(d))})})}async function M(e=1e3){return new Promise(t=>setTimeout(t,e))}const p=1e3,w=p*60,T=w*60,f=T*24,L=f*7,$=f*365.25;function y(e,t){try{if(typeof e=="string"&&e.length>0)return F(e);if(typeof e=="number"&&isFinite(e))return t?.long?C(e):U(e);throw new Error("Value is not a string or number.")}catch(r){const n=B(r)?`${r.message}. value=${JSON.stringify(e)}`:"An unknown error has occured.";throw new Error(n)}}function F(e){if(e=String(e),e.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return NaN;const r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*$;case"weeks":case"week":case"w":return r*L;case"days":case"day":case"d":return r*f;case"hours":case"hour":case"hrs":case"hr":case"h":return r*T;case"minutes":case"minute":case"mins":case"min":case"m":return r*w;case"seconds":case"second":case"secs":case"sec":case"s":return r*p;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}function U(e){const t=Math.abs(e);return t>=f?`${Math.round(e/f)}d`:t>=T?`${Math.round(e/T)}h`:t>=w?`${Math.round(e/w)}m`:t>=p?`${Math.round(e/p)}s`:`${e}ms`}function C(e){const t=Math.abs(e);return t>=f?g(e,t,f,"day"):t>=T?g(e,t,T,"hour"):t>=w?g(e,t,w,"minute"):t>=p?g(e,t,p,"second"):`${e} ms`}function g(e,t,r,n){const s=t>=r*1.5;return`${Math.round(e/r)} ${n}${s?"s":""}`}function B(e){return typeof e=="object"&&e!==null&&"message"in e}const D=".survey-meta-fields",G=".labeled-attribute__attribute",P=".footer > button",W=".modal-container.visible",_="tryrating-storage";async function q(){return await k(P)}function V(){return document.querySelector(W)}async function j(){const e=await k(D);if(!e)return;await M(1e4);const t=Array.from(e.querySelectorAll(G));if(!t.length)return;const[r,n,s]=t;return{taskType:r.textContent,estimatedRatingTime:s.textContent}}function K(e){return e.trim().split(/\s(?=\d)/).reduce((r,n)=>(r+=y(n),r),0)}class z{constructor(){__publicField(this,"values",[]),this.read(),console.log("storage",this.values)}get data(){return this.values}reset(){this.values=[],GM_setValue(_,this.values)}read(){return this.values=GM_getValue(_,[]),this.values}write(t){this.values.push(t),GM_setValue(_,this.values)}}const Y=e=>(t,r)=>(e.set(t,r),r),R=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,O=536870912,A=O*2,H=(e,t)=>r=>{const n=t.get(r);let s=n===void 0?r.size:n<A?n+1:0;if(!r.has(s))return e(r,s);if(r.size<O){for(;r.has(s);)s=Math.floor(Math.random()*A);return e(r,s)}if(r.size>R)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;r.has(s);)s=Math.floor(Math.random()*R);return e(r,s)},N=new WeakMap,X=Y(N),v=H(X,N),Z=e=>e.method!==void 0&&e.method==="call",J=e=>e.error===null&&typeof e.id=="number",S=((e,t)=>{let r=null;return()=>{if(r!==null)return r;const n=new Blob([t],{type:"application/javascript; charset=utf-8"}),s=URL.createObjectURL(n);return r=e(s),setTimeout(()=>URL.revokeObjectURL(s)),r}})(e=>{const t=new Map([[0,()=>{}]]),r=new Map([[0,()=>{}]]),n=new Map,s=new Worker(e);return s.addEventListener("message",({data:c})=>{if(Z(c)){const{params:{timerId:o,timerType:i}}=c;if(i==="interval"){const u=t.get(o);if(typeof u=="number"){const m=n.get(u);if(m===void 0||m.timerId!==o||m.timerType!==i)throw new Error("The timer is in an undefined state.")}else if(typeof u<"u")u();else throw new Error("The timer is in an undefined state.")}else if(i==="timeout"){const u=r.get(o);if(typeof u=="number"){const m=n.get(u);if(m===void 0||m.timerId!==o||m.timerType!==i)throw new Error("The timer is in an undefined state.")}else if(typeof u<"u")u(),r.delete(o);else throw new Error("The timer is in an undefined state.")}}else if(J(c)){const{id:o}=c,i=n.get(o);if(i===void 0)throw new Error("The timer is in an undefined state.");const{timerId:u,timerType:m}=i;n.delete(o),m==="interval"?t.delete(u):r.delete(u)}else{const{error:{message:o}}=c;throw new Error(o)}}),{clearInterval:c=>{const o=v(n);n.set(o,{timerId:c,timerType:"interval"}),t.set(c,o),s.postMessage({id:o,method:"clear",params:{timerId:c,timerType:"interval"}})},clearTimeout:c=>{const o=v(n);n.set(o,{timerId:c,timerType:"timeout"}),r.set(c,o),s.postMessage({id:o,method:"clear",params:{timerId:c,timerType:"timeout"}})},setInterval:(c,o)=>{const i=v(t);return t.set(i,()=>{c(),typeof t.get(i)=="function"&&s.postMessage({id:null,method:"set",params:{delay:o,now:performance.now(),timerId:i,timerType:"interval"}})}),s.postMessage({id:null,method:"set",params:{delay:o,now:performance.now(),timerId:i,timerType:"interval"}}),i},setTimeout:(c,o)=>{const i=v(r);return r.set(i,c),s.postMessage({id:null,method:"set",params:{delay:o,now:performance.now(),timerId:i,timerType:"timeout"}}),i}}},`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`),Q=e=>S().clearInterval(e),ee=(e,t)=>S().setInterval(e,t);class te{constructor(t,r){__publicField(this,"intervalId"),__publicField(this,"ms",0),this.onTick=t,this.onEnd=r}onTickTimer(){this.ms-=1e3;const t=y(this.ms,{long:!0});this.onTick(t),this.ms===0&&(this.onEnd(),this.stop())}start(t){this.stop(),this.ms=t,this.intervalId=ee(()=>this.onTickTimer(),1e3)}stop(){this.intervalId&&Q(this.intervalId)}}const de="";class re{constructor(t){this.storage=t}download(){const t=this.storage.read();if(!t.length){alert("\u041D\u0435\u0442\u0443 \u0434\u0430\u043D\u043D\u044B\u0445 \u0434\u043B\u044F \u044D\u043A\u0441\u043F\u043E\u0440\u0442\u0430.");return}const r=new Date,n=new Intl.DateTimeFormat("ru-RU",{timeZone:"UTC",timeZoneName:"short"}),s=a("table",{border:"1"}),d=a("caption"),E=a("tr",[a("th","Task Type"),a("th","Estimated Rating Time")]);s.append(d,E);let I=0;for(const{type:o,estimated:i}of t){I+=i;const u=a("tr",[a("td",o),a("td",y(i,{long:!0}))]);s.append(u)}d.textContent=`Tasks ${n.format(r)} (${y(I,{long:!0})})`;const x=new Blob([s.outerHTML],{type:"text/html"});a("a",{href:URL.createObjectURL(x),download:`tryrating-com-${r.toISOString()}.html`}).click()}}function ne(e){const t=a("div",{className:"tryrating-container"}),r=a("span",`Tasks: ${e.data.length}`),n=a("span");return t.append(n,r),document.body.appendChild(t),{render:s=>{n.textContent=`Time: ${s}`}}}const b=new z,se=new re(b),oe=ne(b);window.addEventListener("keydown",e=>{e.altKey&&e.code==="KeyQ"&&(e.preventDefault(),se.download()),e.altKey&&e.code==="KeyW"&&(e.preventDefault(),confirm(`Reset data.
Are you sure?`)&&b.reset())});async function ie(){const e=await q(),t=await j();if(!t){alert("\u0417\u0430\u0434\u0430\u043D\u0438\u0435 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E, \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443 \u0438\u043B\u0438 \u043E\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044C \u043A \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A\u0443!");return}async function r(){b.write({type:t.taskType,estimated:n}),await M(5e3),location.reload()}const n=K(t.estimatedRatingTime);new te(d=>oe.render(d),async()=>{e.click(),await M(500),V()?(GM_notification({title:"\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0437\u0430\u0434\u0430\u043D\u0438\u0435",text:t.taskType,highlight:!0,silent:!1,timeout:0}),e.addEventListener("click",r,{once:!0})):r()}).start(n)}ie(),GM_addStyle(".tryrating-container{position:absolute;z-index:99999;background:#2e2c2f;font-size:1rem;font-weight:600;color:#fff;width:100px;bottom:12%;padding:4px;text-align:center}")})();
